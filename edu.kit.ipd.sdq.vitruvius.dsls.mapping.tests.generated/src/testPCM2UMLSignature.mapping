import "http://edu.kit.ipd.sdq.vitruvius.tests.metamodels.pcm_mockup" as mpcm
import "http://edu.kit.ipd.sdq.vitruvius.tests.metamodels.uml_mockup" as muml

mapping signature_M0:
map [ mpcm.Repository ]
and [ muml.UPackage ] {
	[
		equal(repository.name, uPackage.name)
	]
}

mapping signature_M1:
when (signature_M0 as m0)
map [ mpcm.Component ] with [
	in(component, m0::repository.components)
	xbase
		check { !mpcm.component.name.endsWith("_map") }
		enforce {
			val nameOrEmpty = mpcm.component.name ?: ""
			if (!nameOrEmpty.endsWith("_map")) {
				mpcm.component.name = nameOrEmpty + "_map"
			}
		}
]
and [ muml.UClass ] with [
	in(uClass, m0::uPackage.classes)
	xbase
		check { !muml.UClass.name.endsWith("_map") }
		enforce {
			val nameOrEmpty = muml.UClass.name ?: ""
			if (!nameOrEmpty.endsWith("_map")) {
				muml.UClass.name = nameOrEmpty + "_map"
			}
		}
	] {
	[
		equal(component.name, uClass.name)
	]
}